function [Pa,Cu1a,Cu2a,sumP,sumCu1a,sumCu2a,fe]=mod_efe_scan_acceleration(scan,acceleration_channel,Meta_Data,h_freq)
% get epsilon and the cutting frequency 


nfft=Meta_Data.PROCESS.nfft;
nfftc=Meta_Data.PROCESS.nfftc;
Fs=Meta_Data.PROCESS.Fs_epsi;
fc1=Meta_Data.PROCESS.fc1;
fc2=Meta_Data.PROCESS.fc2;

[P,fe] = pwelch(detrend(scan.(acceleration_channel)),nfft,[],nfft,Fs,'psd');
[Cu1a,fec] = mscohere(detrend(scan.s1),detrend(scan.(acceleration_channel)),nfft./3,[],nfft,Fs);
[Cu2a,~] = mscohere(detrend(scan.s2),detrend(scan.(acceleration_channel)),nfft./3,[],nfft,Fs);

% get the filter transfer functions.
if nargin<5
    h_freq=get_filters_MADRE(Meta_Data,fe);
end

if length(fec)~=length(fe)
    Cu1a=interp1(fec,Cu1a,fe);
    Cu2a=interp1(fec,Cu2a,fe);
end

filter_TF=(h_freq.electAccel);
Pa   = P./filter_TF;
sumP=sum(Pa(fe>fc1 & fe<fc2))*nanmean(diff(fe));
sumCu1a=sum(Cu1a(fe>fc1 & fe<fc2))*nanmean(diff(fe));
sumCu2a=sum(Cu2a(fe>fc1 & fe<fc2))*nanmean(diff(fe));
